# 节点执行结果显示功能

## 功能概述

在工作流运行后，每个被执行的节点会在节点下方显示执行结果，让用户可以实时查看每个节点的输出数据。

## 功能特点

### 1. 自动显示执行结果
- ✅ 工作流运行后，所有执行过的节点自动显示结果
- ✅ 结果显示在节点下方，不遮挡节点本身
- ✅ 支持展开/收起长内容

### 2. 状态指示
- 🔵 **运行中** - 蓝色边框，显示加载动画
- 🟢 **成功** - 绿色边框，显示成功图标
- 🔴 **失败** - 红色边框，显示错误信息

### 3. 智能数据格式化
- **文本数据** - 直接显示
- **数组数据** - 显示前3项 + 总数
- **对象数据** - JSON格式化显示
- **爬虫数据** - 特殊格式化，显示抓取条数
- **AI响应** - 显示文本 + Token用量
- **时间数据** - 格式化为本地时间

### 4. 交互功能
- 📏 **展开/收起** - 长内容可以展开查看完整数据
- 📊 **元数据显示** - 显示Token用量、执行时间等
- 🎨 **状态着色** - 不同状态使用不同颜色

## 使用示例

### 示例 1: 爬虫节点

```
┌─────────────────────────┐
│ 🌐 打开网页             │
│ https://top.baidu.com   │
└─────────────────────────┘
┌─────────────────────────┐
│ ✓ 执行成功              │
│ 页面加载完成            │
│ 标题: 百度热搜榜        │
│ ⏱ 12:30:45             │
└─────────────────────────┘
```

### 示例 2: 获取文本节点

```
┌─────────────────────────┐
│ 📝 获取文本             │
│ .c-single-text-ellipsis │
└─────────────────────────┘
┌─────────────────────────┐
│ ✓ 执行成功              │
│ 抓取到 51 条数据:       │
│ 1. 一起为梦想奋斗...    │
│ 2. 2026年最新放假通知   │
│ 3. 台湾网友：这么近...  │
│ ...                     │
│ [展开 ▼]                │
└─────────────────────────┘
```

### 示例 3: AI节点

```
┌─────────────────────────┐
│ 🤖 LLM文本生成          │
│ GPT-4                   │
└─────────────────────────┘
┌─────────────────────────┐
│ ✓ 执行成功              │
│ 这是一个关于...的回答   │
│ 内容详细且准确。        │
│                         │
│ ⚡ 150 tokens           │
│ ⏱ 1250ms               │
└─────────────────────────┘
```

### 示例 4: 错误状态

```
┌─────────────────────────┐
│ 🌐 打开网页             │
│ https://invalid.url     │
└─────────────────────────┘
┌─────────────────────────┐
│ ✗ 执行失败              │
│ 错误: 网络连接超时      │
│ 请检查URL是否正确       │
└─────────────────────────┘
```

## 技术实现

### 组件结构

```
NodeExecutionResult.tsx
├── 状态判断 (idle/running/success/error)
├── 数据格式化
│   ├── formatOutput() - 智能格式化
│   ├── 文本处理
│   ├── 数组处理
│   ├── 对象处理
│   └── 特殊数据处理
├── UI渲染
│   ├── Header (状态图标 + 文本)
│   ├── Content (格式化后的数据)
│   └── Footer (元数据: tokens, 时间等)
└── 交互功能
    └── 展开/收起
```

### 集成方式

```typescript
// BaseNode.tsx
import { NodeExecutionResult } from './NodeExecutionResult';

// 在节点底部添加
<NodeExecutionResult 
  output={nodeOutput}
  executionState={executionState || 'idle'}
/>
```

### 数据流

```
1. 工作流执行
   ↓
2. workflowStore.runWorkflow()
   ↓
3. 每个节点执行完成
   ↓
4. setNodeOutput(nodeId, output)
   ↓
5. nodeOutputs[nodeId] 更新
   ↓
6. NodeExecutionResult 组件接收数据
   ↓
7. 格式化并显示结果
```

## 数据格式化规则

### 1. 文本数据
```typescript
input: "Hello World"
output: "Hello World"
```

### 2. 数组数据
```typescript
input: [1, 2, 3, 4, 5]
output: "数组 (5 项)\n[1, 2, 3]\n..."
```

### 3. 爬虫数据
```typescript
input: {
  data: [
    { title: "标题1", hot: 999999 },
    { title: "标题2", hot: 888888 }
  ]
}
output: "抓取到 2 条数据:\n1. 标题1 (999999)\n2. 标题2 (888888)"
```

### 4. AI响应
```typescript
input: {
  text: "这是AI的回答",
  usage: { totalTokens: 150 },
  latency: 1250
}
output: "这是AI的回答\n\n[用量: 150 tokens]"
```

### 5. 时间数据
```typescript
input: {
  formatted: "2026-01-01 12:30:45",
  timestamp: 1735718445000
}
output: "2026-01-01 12:30:45"
```

### 6. 错误数据
```typescript
input: {
  error: "网络连接超时"
}
output: "错误: 网络连接超时"
```

## 样式设计

### 颜色方案

| 状态 | 背景色 | 边框色 | 文字色 | 图标 |
|------|--------|--------|--------|------|
| 运行中 | blue-50 | blue-200 | blue-700 | Loader2 (旋转) |
| 成功 | green-50 | green-200 | green-700 | CheckCircle |
| 失败 | red-50 | red-200 | red-700 | XCircle |

### 动画效果

```css
/* 淡入 + 下滑 */
animate-in fade-in slide-in-from-top-2

/* 展开/收起 */
transition-all duration-200
```

### 响应式设计

- **最小宽度**: 220px (跟随节点宽度)
- **最大宽度**: 320px
- **最大高度**: 
  - 收起: 100px
  - 展开: 300px

## 用户体验优化

### 1. 性能优化
- ✅ 使用 memo 避免不必要的重渲染
- ✅ 长内容默认收起，减少DOM节点
- ✅ 使用虚拟滚动（未来优化）

### 2. 可读性优化
- ✅ 等宽字体显示代码/JSON
- ✅ 语法高亮（未来优化）
- ✅ 自动换行，避免横向滚动
- ✅ 合理的行高和间距

### 3. 交互优化
- ✅ 展开/收起按钮明显
- ✅ 鼠标悬停显示完整内容（未来优化）
- ✅ 支持复制内容（未来优化）
- ✅ 支持导出数据（未来优化）

## 未来改进

### 短期（1-2周）
- [ ] 添加复制按钮
- [ ] 添加导出功能（JSON/CSV）
- [ ] 优化长文本显示
- [ ] 添加搜索/过滤功能

### 中期（1-2月）
- [ ] 语法高亮
- [ ] 数据可视化（图表）
- [ ] 历史记录查看
- [ ] 对比不同执行结果

### 长期（3-6月）
- [ ] 实时流式输出
- [ ] 数据分析工具
- [ ] 自定义格式化规则
- [ ] AI辅助数据解读

## 测试场景

### 场景 1: 基础文本输出
```
节点: 时间节点
输出: "2026-01-01 12:30:45"
预期: 直接显示时间字符串
```

### 场景 2: 数组数据
```
节点: 获取文本 (multiple: true)
输出: ["文本1", "文本2", "文本3", ...]
预期: 显示前3项 + 总数
```

### 场景 3: 爬虫数据
```
节点: 网页爬虫
输出: { data: [{title: "...", hot: 999}] }
预期: 格式化显示抓取结果
```

### 场景 4: 错误处理
```
节点: HTTP请求
输出: { error: "404 Not Found" }
预期: 红色错误提示
```

### 场景 5: 长内容
```
节点: AI文本生成
输出: 500字的长文本
预期: 默认收起，显示展开按钮
```

## 常见问题

### Q1: 为什么有些节点不显示结果？
**A**: 只有执行过的节点才会显示结果。如果节点状态是 `idle`，说明还没有执行到该节点。

### Q2: 如何清除执行结果？
**A**: 重新运行工作流会清除之前的结果。也可以手动刷新页面。

### Q3: 结果显示不完整怎么办？
**A**: 点击展开按钮查看完整内容。如果还是不够，可以使用导出功能（即将支持）。

### Q4: 可以自定义显示格式吗？
**A**: 目前使用智能格式化，未来会支持自定义格式化规则。

### Q5: 执行结果会保存吗？
**A**: 当前只在内存中保存，刷新页面会丢失。未来会支持历史记录功能。

## 总结

节点执行结果显示功能大大提升了工作流的可调试性和可观察性：

1. **实时反馈** - 立即看到每个节点的执行结果
2. **智能格式化** - 自动识别数据类型并优化显示
3. **状态清晰** - 一目了然地看到成功/失败状态
4. **易于调试** - 快速定位问题节点

这个功能特别适合：
- 🔍 调试工作流
- 📊 查看数据流转
- 🐛 排查错误
- 📈 监控执行状态

---

**版本**: v1.0  
**日期**: 2026-01-01  
**状态**: ✅ 已完成
